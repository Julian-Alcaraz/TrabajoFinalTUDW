<form (ngSubmit)="enviarFormulario()" [formGroup]="oftalmologiaForm">
  <div class="grid gap-6 md:grid-cols-4">
    <!-- Campos generales: -->
    <!-- Obra Social: -->
    <div class="col-span-2">
      <label for="obra_social" class="block mb-2 text-sm font-medium text-gray-900">Obra Social</label>
      <input formControlName="obra_social" type="text" id="obra_social"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
        placeholder="Ej: Osde" />
      <div
        *ngIf="oftalmologiaForm.get('obra_social')?.errors && (oftalmologiaForm.get('obra_social')?.dirty || oftalmologiaForm.get('obra_social')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('obra_social')?.errors?.['minlength']">Minimo 3 caracteres.</div>
        <div *ngIf="oftalmologiaForm.get('obra_social')?.errors?.['maxlength']">Maximo 100 caracteres.
        </div>
        <div *ngIf="oftalmologiaForm.get('obra_social')?.errors?.['ValidarSoloLetras']">Solo puede tener
          letras.
        </div>
        <div *ngIf="oftalmologiaForm.get('obra_social')?.errors?.['ValidarCadenaSinEspacios']">El campo no
          puede
          estar en blanco.
        </div>
      </div>
    </div>
    <!-- Edad: -->
    <div class="col-span-2">
      <label for="edad" class="block mb-2 text-sm font-medium text-gray-900">Edad</label>
      <input formControlName="edad" type="number" id="edad"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
        placeholder="Ej: 10" required />
      <div
        *ngIf="oftalmologiaForm.get('edad')?.errors && (oftalmologiaForm.get('edad')?.dirty || oftalmologiaForm.get('edad')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('edad')?.errors?.['required']">El campo es requerido.</div>
        <div *ngIf="oftalmologiaForm.get('edad')?.errors?.['ValidarSoloNumeros']">Solo puede tener
          números.
        </div>
        <div *ngIf="oftalmologiaForm.get('edad')?.errors?.['ValidarCadenaSinEspacios']">El campo no puede
          estar en
          blanco.
        </div>
      </div>
    </div>
    <!-- Observaciones: cambiar a textarea -->
    <div class="col-span-4">
      <label for="observaciones" class="block mb-2 text-sm font-medium text-gray-900">Observaciones</label>
      <input formControlName="observaciones" type="text" id="observaciones"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
        placeholder="" />
      <div
        *ngIf="oftalmologiaForm.get('observaciones')?.errors && (oftalmologiaForm.get('observaciones')?.dirty || oftalmologiaForm.get('observaciones')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('observaciones')?.errors?.['minlength']">Minimo 1 caracter.</div>
        <div *ngIf="oftalmologiaForm.get('observaciones')?.errors?.['maxlength']">Maximo 1000 caracteres.
        </div>
        <div *ngIf="oftalmologiaForm.get('observaciones')?.errors?.['ValidarSoloLetras']">Solo puede tener
          letras.
        </div>
        <div *ngIf="oftalmologiaForm.get('observaciones')?.errors?.['ValidarCadenaSinEspacios']">El campo
          no
          puede
          estar en blanco.
        </div>
      </div>
    </div>
    <!-- Dni: -->
    <div class="col-span-2">
      <label for="dni" class="block mb-2 text-sm font-medium text-gray-900">Documento</label>
      <input (change)="onChangeDni()" formControlName="dni" type="number" id="dni"
        aria-describedby="helper-text-explanation"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
        placeholder="xxxxx" required />
      <div
        *ngIf="oftalmologiaForm.get('dni')?.errors && (oftalmologiaForm.get('dni')?.dirty || oftalmologiaForm.get('dni')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('dni')?.errors?.['required']">El campo es requerido.</div>
        <div *ngIf="oftalmologiaForm.get('dni')?.errors?.['ValidarSoloNumeros']">Solo se permiten números.
        </div>
        <div *ngIf="oftalmologiaForm.get('dni')?.errors?.['ValidarDni']">Debe tener 8 digitos.</div>
        <div *ngIf="oftalmologiaForm.get('dni')?.errors?.['dniExistente']">Ese dni no esta cargado en el
          sistema.
        </div>
      </div>
    </div>
    <!-- Mensaje para cargar el chico si el DNI no existe -->
    <div class="col-span-2">
      <div *ngIf="oftalmologiaForm.get('dni')?.value !== null && oftalmologiaForm.get('dni')?.value !== ''">
        <div *ngIf="chico === null && this.oftalmologiaForm.get('dni')?.value.toString().length === 8"
          class="bg-blue-100 border border-blue-300 text-blue-600 text-sm p-4 rounded-lg mt-2">
          <div class="flex items-center">
            <svg class="w-10 h-10 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4.5m0 3.75h.008v.008H12v-.008zm0 0H8.25A2.25 2.25 0 016 13.5v-3a2.25 2.25 0 012.25-2.25H12m0 0h3.75A2.25 2.25 0 0118 10.5v3a2.25 2.25 0 01-2.25 2.25H12" />
            </svg>
            <a href="#" (click)="1 + 1" class="font-semibold underline hover:text-blue-800">Chico no cargado, haz clic
              aquí para cargarlo.</a>
          </div>
        </div>
        <div *ngIf="chico !== null" class="mt-4 col-span-2">
          <p class="text-green-600 font-bold">Chico Seleccionado</p>
          <p>Nombre chico: <span class="font-semibold">{{ chico.nombre }}</span></p>
          <p>Apellido chico: <span class="font-semibold">{{ chico.apellido }}</span></p>
          <p>Podrian agregarse mas datos del chico aca...</p>
        </div>
      </div>
    </div>
    <!-- Institucion -->
    <div class="col-span-2">
      <label for="institucion" class="block mb-2 text-sm font-medium text-gray-900">Institucion</label>
      <select (change)="1+1" formControlName="id_institucion" id="id_institucion"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
        <option value="" disabled selected>Selecciona una opción</option>
        <option value="new">Cargar una institucion (no esta implementado)</option>
        <option *ngFor="let institucion of instituciones" [value]="institucion.id">{{ institucion.nombre }}</option>
      </select>
      <div
        *ngIf="oftalmologiaForm.get('id_institucion')?.errors && (oftalmologiaForm.get('id_institucion')?.dirty || oftalmologiaForm.get('id_institucion')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('id_institucion')?.errors?.['required']">Debe seleccionar una opción.</div>
      </div>
    </div>
    <!-- Curso -->
    <div class="col-span-2">
      <label for="curso" class="block mb-2 text-sm font-medium text-gray-900">Institucion</label>
      <select formControlName="id_curso" id="id_curso"
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
        <option value="" disabled selected>Selecciona una opción</option>
        <option value="new">Cargar un curso (no esta implementado)</option>
        <option *ngFor="let curso of cursos" [value]="curso.id">{{ curso.nombre }}</option>
      </select>
      <div
        *ngIf="oftalmologiaForm.get('id_curso')?.errors && (oftalmologiaForm.get('id_curso')?.dirty || oftalmologiaForm.get('id_curso')?.touched)"
        class="text-red-600 text-sm">
        <div *ngIf="oftalmologiaForm.get('id_curso')?.errors?.['required']">Debe seleccionar una opción.</div>
      </div>
    </div>
  </div>
  <!-- Campos oftalmologica -->
  <!-- Demanda -->
  <label for="demanda" class="block mb-2 text-sm font-medium text-gray-900">Demanda</label>
  <input formControlName="demanda" type="text" id="demanda"
    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
    placeholder="" required />
  <div
    *ngIf="oftalmologiaForm.get('demanda')?.errors && (oftalmologiaForm.get('demanda')?.dirty || oftalmologiaForm.get('demanda')?.touched)"
    class="text-red-600 text-sm">
    <div *ngIf="oftalmologiaForm.get('demanda')?.errors?.['ValidarCadenaSinEspacios']">El campo no puede
      estar en blanco.
    </div>
    <div *ngIf="oftalmologiaForm.get('demanda')?.errors?.['required']">El campo es requerido.</div>
    <div *ngIf="oftalmologiaForm.get('demanda')?.errors?.['maxlength']">Maximo 100 caracteres.
    </div>
    <div *ngIf="oftalmologiaForm.get('demanda')?.errors?.['minlength']">Mínimo 1 caracter.</div>
  </div>
  <!-- Primera Vez -->
  <div class="mt-4 col-span-1">
    <div class="flex items-center">
      <input (change)="onCheckboxChange($event)" id="primera_vez" type="checkbox" formControlName="primera_vez"
        class="mr-2 rounded text-blue-600 focus:ring-blue-500" />
      <label for="primera_vez" class="text-sm text-gray-700">Primera Vez</label>
    </div>
    <div
      *ngIf="oftalmologiaForm.get('primera_vez')?.errors && (oftalmologiaForm.get('primera_vez')?.dirty || oftalmologiaForm.get('primera_vez')?.touched)"
      class="text-red-600 text-sm">
      <div *ngIf="oftalmologiaForm.get('primera_vez')?.errors?.['required']">Debe seleccionar una opción.</div>
    </div>
  </div>
  <!-- Control -->
  <div class="mt-4 col-span-1">
    <div class="flex items-center">
      <input (change)="onCheckboxChange($event)" id="control" type="checkbox" formControlName="control"
        class="mr-2 rounded text-blue-600 focus:ring-blue-500" />
      <label for="control" class="text-sm text-gray-700">Control</label>
    </div>
    <div
      *ngIf="oftalmologiaForm.get('control')?.errors && (oftalmologiaForm.get('control')?.dirty || oftalmologiaForm.get('control')?.touched)"
      class="text-red-600 text-sm">
      <div *ngIf="oftalmologiaForm.get('control')?.errors?.['required']">Debe seleccionar una opción.</div>
    </div>
  </div>
  <!-- Receta -->
  <div class="mt-4 col-span-1">
    <div class="flex items-center">
      <input (change)="onCheckboxChange($event)" id="receta" type="checkbox" formControlName="receta"
        class="mr-2 rounded text-blue-600 focus:ring-blue-500" />
      <label for="receta" class="text-sm text-gray-700">Receta</label>
    </div>
    <div
      *ngIf="oftalmologiaForm.get('receta')?.errors && (oftalmologiaForm.get('receta')?.dirty || oftalmologiaForm.get('receta')?.touched)"
      class="text-red-600 text-sm">
      <div *ngIf="oftalmologiaForm.get('receta')?.errors?.['required']">Debe seleccionar una opción.</div>
    </div>
  </div>
  <!-- Anteojos -->
  <div class="mt-4 col-span-1">
    <div class="flex items-center">
      <input (change)="onCheckboxChange($event)" id="anteojos" type="checkbox" formControlName="anteojos"
        class="mr-2 rounded text-blue-600 focus:ring-blue-500" />
      <label for="anteojos" class="text-sm text-gray-700">Anteojos</label>
    </div>
    <div
      *ngIf="oftalmologiaForm.get('anteojos')?.errors && (oftalmologiaForm.get('anteojos')?.dirty || oftalmologiaForm.get('anteojos')?.touched)"
      class="text-red-600 text-sm">
      <div *ngIf="oftalmologiaForm.get('anteojos')?.errors?.['required']">Debe seleccionar una opción.</div>
    </div>
  </div>
  <!-- Proximo Control -->
  <div>
    <p class="block mb-2 text-sm font-medium text-gray-900">Próximo Control</p>
    <mat-form-field class="col-span-2">
      <mat-label>Proximo Control</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="prox_control" [min]="fechaManana" />
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-hint
        *ngIf="oftalmologiaForm.get('prox_control')?.errors && (oftalmologiaForm.get('prox_control')?.dirty || oftalmologiaForm.get('prox_control')?.touched) && oftalmologiaForm.get('prox_control')?.errors?.['required']"
        class="text-red-600">El campo es requerido. </mat-hint>
    </mat-form-field>
  </div>
  <!-- Enviar -->
  <div class="flex my-auto p-10">
    <!--  [disabled]="!oftalmologiaForm.valid" -->
    <button type="submit"
      class="flex my-auto ml-auto text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-3 py-2 text-center -700 -800 disabled:bg-gray-400">Agregar
    </button>
  </div>
</form>
